@*@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Service History";

    var CancelId = 0;
    var CancelId1 = 0;

    var RescheduleId = 0;
    var RescheduleId1 = 0;

    var a = 0;
    var b = 0;

    var row = 0;
    var row1 = 0;

    var CancelId2 = 0;
    var RescheduleId2 = 0;

}

@model HelperLand.ViewModels.DashboardViewModel

<section class="welcome-section">
    <div class="d-flex justify-content-center">
        <h1 class="welcome-header">Welcome, <span class="welcome-sandip">@Model.userData[0].FirstName !</span></h1>
    </div>
</section>
<section class="service-section table-responsive">
    <div class="container container-fluid d-flex justify-content-center">
        <div class="content1 table-responsive">
            <input type="radio" name="slider" checked id="dashboard" style="display: none;">
            <input type="radio" name="slider" id="service-history" style="display: none;">
            <input type="radio" name="slider" id="service-schedule" style="display: none;">
            <input type="radio" name="slider" id="favourite-pros" style="display: none;">
            <input type="radio" name="slider" id="invoices" style="display: none;">
            <input type="radio" name="slider" id="notifications" style="display: none;">
            <div class="list">
                <label for="dashboard" class="dashboard">
                    <span class="title">Dashboard</span>
                </label>
                <label for="service-history" class="service-history">
                    <span class="title">Service History</span>
                </label>
                <label for="service-schedule" class="service-schedule">
                    <span class="title">Service Schedule</span>
                </label>
                <label for="favourite-pros" class="favourite-pros">
                    <span class="title">Favourite Pros</span>
                </label>
                <label for="invoices" class="invoices">
                    <span class="title">Invoices</span>
                </label>
                <label for="notifications" class="notifications">
                    <span class="title">Notifications</span>
                </label>
               
                <span class="none">
                </span>
                <div class="slider"></div>
            </div>
            <div class="text-content">
                <div class="dashboard text">
                    <span class="service-header">Current Service Requests</span>
                    <a asp-action="BookService" asp-controller="BookingService" class="addServiceExport">Add New Service Request</a>
                    <div class="table-responsive mt-3">
                        <table class="table">
                            <thead>
                                <tr class="table-heading">
                                    <th scope="col">Service Id</th>
                                    <th scope="col">Service Date</th>
                                    <th scope="col">Service Provider</th>
                                    <th scope="col">Payment</th>
                                    <th scope="col" class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.dashboardData) {
                                    CancelId = CancelId + 1;
                                    var x = "#Cancel"+CancelId;

                                    RescheduleId=RescheduleId+1;
                                    var y = "#Reschedule" + RescheduleId;

                                    row = row + 1;
                                    var z = "#row" + row;
                                    var endtime = item.ServiceStartDate.TimeOfDay.Hours + item.ServiceHours;
                                    <tr data-bs-toggle="modal" data-bs-target=@z>
                                        <td>@Html.DisplayFor(modelItem => item.ServiceId)</td>
                                        <td>
                                            <a href="#"><img src="~/images/calendar.png"></a>
                                            <span class="date">@item.ServiceStartDate.ToString("dd/MM/yyyy")</span>
                                            <br>
                                            <span><img src="~/images/small-watch-logo/layer-712.png">@item.ServiceStartDate.TimeOfDay.Hours.ToString("00"):@item.ServiceStartDate.TimeOfDay.Minutes.ToString("00") - 
                                                @endtime.ToString("00") : @item.ServiceStartDate.TimeOfDay.Minutes.ToString("00")
                                                </span>
                                        </td>
                                        <td>@Html.DisplayFor(modelItem => item.ServiceProvider.FirstName) @Html.DisplayFor(modelItem => item.ServiceProvider.LastName)</td>
                                        <td class="euro">@Html.DisplayFor(modelItem => item.TotalCost) &euro;
                                        </td>
                                        <td>
                                            <button class="btn btn-danger export1 mx-3" data-bs-toggle="modal" data-bs-target=@x>Cancel</button>
                                            <button class="btn btn-primary export" data-bs-toggle="modal" data-bs-target=@y>Reschedule</button>

                                        </td>
                                    </tr>
                                }
                                
                            </tbody>
                        </table>
                        @foreach (var item in Model.dashboardData) {
                            row1 = row1 + 1;
                            var z1 = "row" + row1;

                            CancelId2 = CancelId2 + 1;
                            var x = "#Cancel"+CancelId2;

                            RescheduleId2=RescheduleId2+1;
                            var y = "#Reschedule" + RescheduleId2;

                            <form asp-action="CancelService" asp-controller="Customer" method="post">
                                <div class="modal fade" id=@z1 data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Service Details </h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <p>@item.ServiceStartDate.ToString("dd/MM/yyyy")</p>
                                                <p>Duration: @item.SubTotal Hrs</p>
                                                <hr>
                                                <p>Service Id: @item.ServiceId</p>
                                                <p>Extras: Inside Cabinets</p>
                                                <p>Net Amount:</p>
                                                <hr>
                                                <p>Service Address:</p>
                                                <p>Building Address:</p>
                                                <p>Phone:</p>
                                                <p>Email:</p>
                                                <hr>
                                                <p>Comments:</p>
                                                <hr>
                                            </div>

                                            <div class="modal-footer">
                                                <button class="btn btn-primary export" data-bs-toggle="modal" data-bs-target=@y>Reschedule</button>
                                                <button class="btn btn-danger export1" data-bs-toggle="modal" data-bs-target=@x>Cancelled
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        }

                        <form asp-action="CancelService" asp-controller="Customer" method="post">
                        @foreach (var item in Model.dashboardData) {
                            CancelId1 = CancelId1 + 1;
                            var z = "Cancel"+CancelId1;
                            <div class="modal fade" id=@z data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Cancle Service Request </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Why you want to cancle the service request</p>
                                            <div class="form-floating">
                                                <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                                            </div>
                                        </div>
                                        <input class="d-none" asp-for="CancelServiceId" value=@item.ServiceRequestId />
                                        <button type="submit" class="btn btn-primary export m-3">Cancle Now</button>
                                    </div>
                                </div>
                            </div>
                        }
                        </form>

                        @foreach(var item in Model.dashboardData)
                        {
                            RescheduleId1 = RescheduleId1 + 1;
                            var z = "Reschedule" + RescheduleId1;
                            <form asp-action="ServiceReschedule" asp-controller="Customer" method="post">
                            
                                <div class="modal fade" id=@z data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Reschedule Service Request </h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <p>Select New Date & Time</p>
                                                <div class="row">
                                                    <div class="col">
                                                        <input asp-for="ress.newDate" value="@item.ServiceStartDate.Date.Day-@item.ServiceStartDate.Date.Month-@item.ServiceStartDate.Date.Year" type="date" class="form-control">
                                                    </div>
                                                    <div class="col">
                                                        <input asp-for="ress.newTime" value=@item.ServiceStartDate.TimeOfDay type="time" placeholder="12:00" class="form-control">
                                                    </div>
                                                    <input type="text" value=@item.ServiceRequestId asp-for="ress.serviceRequestId">
                                                    <input value="@item.ServiceStartDate.Date.Day-@item.ServiceStartDate.Date.Month-@item.ServiceStartDate.Date.Year">
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary export m-3">Update</button>
                                        </div>
                                    </div>
                                </div>
                            
                        </form>
                    }
                    </div>

                    
                    <div class="d-flex flex-row">
                        <div class="show">Show</div>
                        <div class="dropdown">
                            <button class="btn btn-secondary button-dd dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">10
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" href="#">20</a></li>
                                <li><a class="dropdown-item" href="#">30</a></li>
                                <li><a class="dropdown-item" href="#">40</a></li>
                                <li><a class="dropdown-item" href="#">50</a></li>
                                <li><a class="dropdown-item" href="#">55</a></li>
                            </ul>
                        </div>
                        <span class="show">entries</span>
                        <span class="show">Total Record: 55</span>

                        <div class="d-flex justify-content-end">
                            <a href="#"><i class="fa fa-step-backward chng-arw"></i></a>
                            <a href="#"><i class="fa fa-angle-left chng-arw"></i></a>
                            <span class="chng-num"><a href="#">1</a></span>
                            <span class="chng-num"><a href="#">2</a></span>
                            <span class="chng-num"><a href="#">3</a></span>
                            <span class="chng-num"><a href="#">4</a></span>
                            <a href="#"><i class="fa fa-angle-right chng-arw"></i></a>
                            <a href="#"><i class="fa fa-step-forward chng-arw"></i></a>
                        </div>
                    </div>
                </div>

                <div class="service-history text">
                    <span class="service-header">Service History</span>
                    <span class="export">Export</span>
                    <table class="table">
                        <thead>
                            <tr class="table-heading">
                                <th scope="col">Service Id</th>
                                <th scope="col">Service Date</th>
                                <th scope="col">Service Provider</th>
                                <th scope="col">Payment</th>
                                <th scope="col">Status</th>
                                <th scope="col">Rate SP </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.serviceHistory) {
                                a = a + 1;
                                var RSP = "#rateSp" + a;

                                var endtime = item.ServiceStartDate.TimeOfDay.Hours + item.ServiceHours;
                                <tr>
                                    <td>@Html.DisplayFor(modelItem => item.ServiceId)</td>
                                    <td>
                                        <a href="#"><img src="~/images/calendar.png"></a> 
                                        <span class="date">@item.ServiceStartDate.ToString("dd/MM/yyyy")</span>
                                        <br>
                                        <span><img src="~/images/small-watch-logo/layer-712.png">
                                            @item.ServiceStartDate.TimeOfDay.Hours.ToString("00"):@item.ServiceStartDate.TimeOfDay.Minutes.ToString("00") - 
                                                @endtime.ToString("00") : @item.ServiceStartDate.TimeOfDay.Minutes.ToString("00")
                                        </span>
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ServiceProvider.FirstName) @Html.DisplayFor(modelItem => item.ServiceProvider.LastName)
                                    </td>
                                    <td class="euro">
                                        @Html.DisplayFor(modelItem => item.TotalCost) &euro;
                                    </td>
                                    <td>
                                        <span class="btn btn-primary cancelled">
                                            <div>Cancelled</div>
                                        </span>
                                    </td>
                                    <td>
                                        @{
                                            var x=0;
                                        }
                                        @foreach(var item1 in Model.ratingDataTable)
                                        {
                                            @if (item1.ServiceRequestId == item.ServiceRequestId)
                                            {
                                                x = 1;
                                                break;
                                            }
                                            else
                                            {
                                                
                                            }
                                        }
                                        @if (x == 1)
                                        {
                                            <span class="rate-sp" disabled>Rate SP</span>
                                        }
                                        else
                                        {
                                            <span class="btn btn-primary rate-sp" data-bs-toggle="modal" data-bs-target=@RSP>Rate SP</span>
                                        }

                                    </td>
                                </tr>
                            }
                            
                        </tbody>
                    </table>

                    @foreach (var item in Model.serviceHistory) {
                        b = b + 1;
                        var ratespid="rateSp"+b;

                        <form asp-action="RateSP" asp-controller="Customer" method="post">
                            <div class="modal fade" id=@ratespid data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">
                                                <img src="/assets/avatar-hat.png" />Sandip Patel
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                                        </div>
                                        <h5 class="m-3">Rate your service provider</h5>
                                        <div class="modal-body">
                                            <div class="d-flex justify-content-between">
                                                <div>On time arrival</div>
                                                <div class="">
                                                    <span id="oat1" class="oat1 fa fa-star"></span>
                                                    <span id="oat2" class="oat2 fa fa-star"></span>
                                                    <span id="oat3" class="oat3 fa fa-star"></span>
                                                    <span id="oat4" class="oat4 fa fa-star"></span>
                                                    <span id="oat5" class="oat5 fa fa-star"></span>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between mt-3">
                                                <div>Friendly</div>
                                                <div class="">
                                                    <span id="f1" class="f1 fa fa-star"></span>
                                                    <span id="f2" class="f2 fa fa-star"></span>
                                                    <span id="f3" class="f3 fa fa-star"></span>
                                                    <span id="f4" class="f4 fa fa-star"></span>
                                                    <span id="f5" class="f5 fa fa-star"></span>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between my-3">
                                                <div>Quality of service</div>
                                                <div class="">
                                                    <span id="qs1" class="qs1 fa fa-star"></span>
                                                    <span id="qs2" class="qs2 fa fa-star"></span>
                                                    <span id="qs3" class="qs3 fa fa-star"></span>
                                                    <span id="qs4" class="qs4 fa fa-star"></span>
                                                    <span id="qs5" class="qs5 fa fa-star"></span>
                                                </div>
                                            </div>
                                            <input class="oat d-none" type="text" value="0" asp-for="rating.OnTimeArrival"/>
                                            <input class="f d-none" type="text" value="0" asp-for="rating.Friendly"/>
                                            <input class="qs d-none" type="text" value="0" asp-for="rating.QuantityOfService"/>
                                            <input type="text" class="d-none" value=@item.ServiceRequestId asp-for="rating.servreqid" />
                                            <input type="text" class="d-none" value=@item.ServiceProviderId asp-for="rating.serproid" />
                                            <p>Feedback on service provider</p>
                                            <div class="form-floating">
                                                <textarea asp-for="rating.comments" class="form-control" placeholder="Leave a comment here" ></textarea>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary export" >Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    }

                    <div class="d-flex flex-row">
                        <div class="show">Show</div>
                        <div class="dropdown">
                            <button class="btn btn-secondary button-dd dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">10
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" href="#">20</a></li>
                                <li><a class="dropdown-item" href="#">30</a></li>
                                <li><a class="dropdown-item" href="#">40</a></li>
                                <li><a class="dropdown-item" href="#">50</a></li>
                                <li><a class="dropdown-item" href="#">55</a></li>
                            </ul>
                        </div>
                        <span class="show">entries</span>
                        <span class="show">Total Record: 55</span>
                        <div class="d-flex justify-content-end">
                            <a href="#"><i class="fa fa-step-backward chng-arw"></i></a>
                            <a href="#"><i class="fa fa-angle-left chng-arw"></i></a>
                            <span class="chng-num"><a href="#">1</a></span>
                            <span class="chng-num"><a href="#">2</a></span>
                            <span class="chng-num"><a href="#">3</a></span>
                            <span class="chng-num"><a href="#">4</a></span>
                            <a href="#"><i class="fa fa-angle-right chng-arw"></i></a>
                            <a href="#"><i class="fa fa-step-forward chng-arw"></i></a>
                        </div>
                    </div>
                </div>

                <div class="service-schedule text">
                   
                </div>

            </div>
        </div>
    </div>
    
    

    
    <div class="modal fade" id="Cancle" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cancle Service Request </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Why you want to cancle the service request</p>
                    <div class="form-floating">
                        <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                    </div>
                </div>
                <button class="btn btn-primary export m-3">Cancle Now</button>
            </div>
        </div>
    </div>
</section>

@section Scripts{
    <script>
        $(document).ready(function(){
            $("oat1").click(function(){
                $(".oat1").addClass("checked");
                $(".oat2").removeClass("checked");
                $(".oat3").removeClass("checked");
                $(".oat4").removeClass("checked");
                $(".oat5").removeClass("checked");
                $(".oat").val("1");
            });

            $(".oat2").click(function(){
                $(".oat1").addClass("checked");
                $(".oat2").addClass("checked");
                $(".oat3").removeClass("checked");
                $(".oat4").removeClass("checked");
                $(".oat5").removeClass("checked");
                $(".oat").val("2");
            });
            $(".oat3").click(function(){
                $(".oat1").addClass("checked");
                $(".oat2").addClass("checked");
                $(".oat3").addClass("checked");
                $(".oat4").removeClass("checked");
                $(".oat5").removeClass("checked");
                $(".oat").val("3");
            });
            $(".oat4").click(function(){
                $(".oat1").addClass("checked");
                $(".oat2").addClass("checked");
                $(".oat3").addClass("checked");
                $(".oat4").addClass("checked");
                $(".oat5").removeClass("checked");
                $(".oat").val("4");
            });
            $(".oat5").click(function(){
                $(".oat1").addClass("checked");
                $(".oat2").addClass("checked");
                $(".oat3").addClass("checked");
                $(".oat4").addClass("checked");
                $(".oat5").addClass("checked");
                $(".oat").val("5");
            });



            //////////friendly//////////

            $(".f1").click(function(){
                $(".f1").addClass("checked");
                $(".f2").removeClass("checked");
                $(".f3").removeClass("checked");
                $(".f4").removeClass("checked");
                $(".f5").removeClass("checked");
                $(".f").val("1");
            });

            $(".f2").click(function(){
                $(".f1").addClass("checked");
                $(".f2").addClass("checked");
                $(".f3").removeClass("checked");
                $(".f4").removeClass("checked");
                $(".f5").removeClass("checked");
                $(".f").val("2");
            });
            $(".f3").click(function(){
                $(".f1").addClass("checked");
                $(".f2").addClass("checked");
                $(".f3").addClass("checked");
                $(".f4").removeClass("checked");
                $(".f5").removeClass("checked");
                $(".f").val("3");
            });
            $(".f4").click(function(){
                $(".f1").addClass("checked");
                $(".f2").addClass("checked");
                $(".f3").addClass("checked");
                $(".f4").addClass("checked");
                $(".f5").removeClass("checked");
                $(".f").val("4");
            });
            $(".f5").click(function(){
                $(".f1").addClass("checked");
                $(".f2").addClass("checked");
                $(".f3").addClass("checked");
                $(".f4").addClass("checked");
                $(".f5").addClass("checked");
                $(".f").val("5");
            });


            //////////quality of service/////////////
            $(".qs1").click(function(){
                $(".qs1").addClass("checked");
                $(".qs2").removeClass("checked");
                $(".qs3").removeClass("checked");
                $(".qs4").removeClass("checked");
                $(".qs5").removeClass("checked");
                $(".qs").val("1");
            });

            $(".qs2").click(function(){
                $(".qs1").addClass("checked");
                $(".qs2").addClass("checked");
                $(".qs3").removeClass("checked");
                $(".qs4").removeClass("checked");
                $(".qs5").removeClass("checked");
                $(".qs").val("2");
            });
            $(".qs3").click(function(){
                $(".qs1").addClass("checked");
                $(".qs2").addClass("checked");
                $(".qs3").addClass("checked");
                $(".qs4").removeClass("checked");
                $(".qs5").removeClass("checked");
                $(".qs").val("3");
            });
            $(".qs4").click(function(){
                $(".qs1").addClass("checked");
                $(".qs2").addClass("checked");
                $(".qs3").addClass("checked");
                $(".qs4").addClass("checked");
                $(".qs5").removeClass("checked");
                $(".qs").val("4");
            });
            $(".qs5").click(function(){
                $(".qs1").addClass("checked");
                $(".qs2").addClass("checked");
                $(".qs3").addClass("checked");
                $(".qs4").addClass("checked");
                $(".qs5").addClass("checked");
                $(".qs").val("5");
            });
        });
    </script>

}